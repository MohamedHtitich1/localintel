# localintel

## Overview

**localintel** (Local Intelligence) is an R package for fetching,
processing, and visualizing subnational (NUTS 0/1/2) data from Eurostat.
It provides a comprehensive pipeline for health system analysis across
European regions, including:

- ğŸ“Š **Data Fetching**: Robust API wrappers for Eurostat datasets
- ğŸ”„ **Data Cascading**: Intelligent propagation from country to
  regional levels
- ğŸ“ˆ **Indicator Computation**: Composite scores for health outcomes,
  enabling environment, and perceptions
- ğŸ—ºï¸ **Visualization**: Publication-ready maps with automatic level
  selection
- ğŸ“¤ **Export**: Tableau-ready GeoJSON exports with enrichment

## Installation

``` r
# Install from GitHub
# install.packages("devtools")
devtools::install_github("MohamedHtitich1/localintel")
```

## Quick Start

``` r
library(localintel)

# 1. Fetch health system data
codes <- health_system_codes()
data_list <- fetch_eurostat_batch(codes, level = 2, years = 2010:2024)

# 2. Process individual datasets
beds <- process_beds(data_list$beds)
physicians <- process_physicians(data_list$physicians)
los <- process_los(data_list$los)

# 3. Merge into single dataset
all_data <- merge_datasets(beds, physicians, los)

# 4. Get reference geometries
nuts2_ref <- get_nuts2_ref()
geopolys <- get_nuts_geopolys()

# 5. Cascade data to NUTS2 level with computed indicators
cascaded <- cascade_to_nuts2_and_compute(
  all_data,
  vars = c("beds", "physicians", "los"),
  nuts2_ref = nuts2_ref,
  years = 2010:2024
)

# 6. Create maps
plot_best_by_country_level(
  cascaded, 
  geopolys, 
  var = "beds",
  years = 2020:2024,
  title = "Hospital Beds per 100,000"
)

# 7. Export for Tableau
sf_data <- build_display_sf(cascaded, geopolys, var = "beds", years = 2010:2024)
export_to_geojson(sf_data, "output/beds_nuts2.geojson")
```

## Key Features

### Data Cascading

The package automatically fills missing regional data by cascading from
parent NUTS levels:

    NUTS0 (Country) â†’ NUTS1 (Major Regions) â†’ NUTS2 (Regions)

This ensures complete coverage while tracking the original data source
level.

### Computed Indicators

Built-in computation for key health system indicators:

| Indicator                          | Description                      | Formula                       |
|------------------------------------|----------------------------------|-------------------------------|
| **DA** (Discharge Activity)        | Hospital utilization metric      | log2(discharges) / log2(beds) |
| **rLOS** (Relative Length of Stay) | Regional vs.Â national comparison | regional LOS / national LOS   |

### Visualization

Automatic â€œbest levelâ€ selection for maps - displays NUTS2 where
available, falls back to NUTS1/NUTS0:

``` r
# Global color scale (consistent across years)
plot_best_by_country_level(data, geopolys, var = "beds", scale = "global")

# Per-year color scale (highlights within-year variation)
plot_best_by_country_level(data, geopolys, var = "beds", scale = "per_year")
```

### Tableau Integration

Full support for Tableau exports with: - Country names and region
labels - Population-weighted aggregations - Performance tags (Best/Worst
by country) - Multi-variable GeoJSON exports

``` r
sf_all <- build_multi_var_sf(
  cascaded, geopolys,
  vars = c("beds", "physicians", "score_health_outcome"),
  years = 2010:2024,
  var_labels = health_var_labels(),
  pillar_mapping = health_pillar_mapping()
)

sf_enriched <- enrich_for_tableau(sf_all, pop_data, nuts2_names)
export_to_geojson(sf_enriched, "tableau_export.geojson")
```

## Data Sources

The package works with Eurostat datasets including:

**Health System Resources:** - `hlth_rs_bdsrg2` - Hospital beds -
`hlth_rs_physreg` - Physicians

**Hospital Activity:** - `hlth_co_disch2t` - In-patient discharges -
`hlth_co_disch4t` - Day-case discharges - `hlth_co_inpstt` - Length of
stay

**Health Outcomes:** - `hlth_cd_asdr2` - Standardised death rates -
`hlth_cd_ypyll` - Potential years of life lost - `hlth_cd_yinfr` -
Infant mortality

**Health Perceptions:** - `hlth_silc_08_r` - Unmet medical needs

## Related Work

This package was developed as part of research on subnational health
system analysis in Europe. Related projects:

- [w2m](https://github.com/MohamedHtitich1/w2m) - Composite indicator
  construction
- [Social Progress Index](https://www.socialprogress.org/) - Framework
  inspiration

## Contributing

Contributions are welcome! Please open an issue or submit a pull
request.

## License

MIT Â© Mohamed Htitich

## Citation

``` bibtex
@software{localintel,
  author = {Htitich, Mohamed},
  title = {localintel: Local Intelligence for Subnational Data Analysis},
  year = {2025},
  url = {https://github.com/MohamedHtitich1/localintel}
}
```

# Package index

## Package Overview

- [`localintel-package`](https://mohamedhtitich1.github.io/localintel/reference/localintel-package.md)
  [`localintel`](https://mohamedhtitich1.github.io/localintel/reference/localintel-package.md)
  : Local Intelligence for Subnational Data Analysis

## Data Fetching

Functions for retrieving data from the Eurostat API.

- [`get_nuts2()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2.md)
  [`get_nuts_level()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2.md)
  [`get_nuts_level_robust()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2.md)
  [`get_nuts_level_safe()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2.md)
  [`fetch_eurostat_batch()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2.md)
  [`drop_empty()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2.md)
  : Eurostat Data Fetching Functions
- [`health_system_codes()`](https://mohamedhtitich1.github.io/localintel/reference/health_system_codes.md)
  [`causes_of_death_codes()`](https://mohamedhtitich1.github.io/localintel/reference/health_system_codes.md)
  : Eurostat Dataset Code Lists

## Reference Data

NUTS reference tables, boundary geometries, and lookup data.

- [`get_nuts2_ref()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2_ref.md)
  [`get_nuts_geo()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2_ref.md)
  [`get_nuts_geopolys()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2_ref.md)
  [`get_nuts2_names()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2_ref.md)
  [`get_population_nuts2()`](https://mohamedhtitich1.github.io/localintel/reference/get_nuts2_ref.md)
  : NUTS Reference Data Functions
- [`keep_eu27()`](https://mohamedhtitich1.github.io/localintel/reference/keep_eu27.md)
  [`eu27_codes()`](https://mohamedhtitich1.github.io/localintel/reference/keep_eu27.md)
  [`nuts_country_names()`](https://mohamedhtitich1.github.io/localintel/reference/keep_eu27.md)
  [`add_country_name()`](https://mohamedhtitich1.github.io/localintel/reference/keep_eu27.md)
  : EU27 Country Filtering and Naming Functions

## Data Processing

Process raw Eurostat datasets and compute composite indicators.

- [`process_beds()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`process_physicians()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`process_los()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`process_hos_days()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`process_disch_inp()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`process_disch_day()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`process_cod()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`process_health_perceptions()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`merge_datasets()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`compute_composite()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  [`transform_and_score()`](https://mohamedhtitich1.github.io/localintel/reference/process_beds.md)
  : Data Processing Functions

## Data Cascading

Cascade data from higher to lower NUTS levels.

- [`cascade_to_nuts2_and_compute()`](https://mohamedhtitich1.github.io/localintel/reference/cascade_to_nuts2_and_compute.md)
  [`cascade_to_nuts2_light()`](https://mohamedhtitich1.github.io/localintel/reference/cascade_to_nuts2_and_compute.md)
  [`balance_panel()`](https://mohamedhtitich1.github.io/localintel/reference/cascade_to_nuts2_and_compute.md)
  : Data Cascading Functions

## Visualization

Build spatial objects and create publication-ready maps.

- [`build_display_sf()`](https://mohamedhtitich1.github.io/localintel/reference/build_display_sf.md)
  [`lc_build_display_sf()`](https://mohamedhtitich1.github.io/localintel/reference/build_display_sf.md)
  [`plot_best_by_country_level()`](https://mohamedhtitich1.github.io/localintel/reference/build_display_sf.md)
  [`build_multi_var_sf()`](https://mohamedhtitich1.github.io/localintel/reference/build_display_sf.md)
  [`level_col_for()`](https://mohamedhtitich1.github.io/localintel/reference/build_display_sf.md)
  [`level_cols_for()`](https://mohamedhtitich1.github.io/localintel/reference/build_display_sf.md)
  : Visualization Functions

## Export

Export data to GeoJSON, Excel, RDS, and PDF formats.

- [`export_to_geojson()`](https://mohamedhtitich1.github.io/localintel/reference/export_to_geojson.md)
  [`export_to_excel()`](https://mohamedhtitich1.github.io/localintel/reference/export_to_geojson.md)
  [`export_to_rds()`](https://mohamedhtitich1.github.io/localintel/reference/export_to_geojson.md)
  [`save_maps_to_pdf()`](https://mohamedhtitich1.github.io/localintel/reference/export_to_geojson.md)
  [`enrich_for_tableau()`](https://mohamedhtitich1.github.io/localintel/reference/export_to_geojson.md)
  [`health_var_labels()`](https://mohamedhtitich1.github.io/localintel/reference/export_to_geojson.md)
  [`health_pillar_mapping()`](https://mohamedhtitich1.github.io/localintel/reference/export_to_geojson.md)
  [`cod_labels()`](https://mohamedhtitich1.github.io/localintel/reference/export_to_geojson.md)
  : Export Functions

## Utilities

Helper functions for data transformation and filtering.

- [`keep_eu27()`](https://mohamedhtitich1.github.io/localintel/reference/keep_eu27.md)
  [`eu27_codes()`](https://mohamedhtitich1.github.io/localintel/reference/keep_eu27.md)
  [`nuts_country_names()`](https://mohamedhtitich1.github.io/localintel/reference/keep_eu27.md)
  [`add_country_name()`](https://mohamedhtitich1.github.io/localintel/reference/keep_eu27.md)
  : EU27 Country Filtering and Naming Functions
- [`safe_log10()`](https://mohamedhtitich1.github.io/localintel/reference/safe_log10.md)
  [`safe_log2()`](https://mohamedhtitich1.github.io/localintel/reference/safe_log10.md)
  [`scale_0_100()`](https://mohamedhtitich1.github.io/localintel/reference/safe_log10.md)
  [`rescale_minmax()`](https://mohamedhtitich1.github.io/localintel/reference/safe_log10.md)
  : Safe Logarithm and Scaling Functions
- [`interp_const_ends_flag()`](https://mohamedhtitich1.github.io/localintel/reference/interp_const_ends_flag.md)
  [`standardize_time()`](https://mohamedhtitich1.github.io/localintel/reference/interp_const_ends_flag.md)
  : Data Interpolation and Time Utilities

# Articles

### Getting Started

- [Getting Started with
  localintel](https://mohamedhtitich1.github.io/localintel/articles/localintel.md):

### Tutorials

- [End-to-End Health System
  Analysis](https://mohamedhtitich1.github.io/localintel/articles/workflow.md):

### Help

- [FAQ &
  Troubleshooting](https://mohamedhtitich1.github.io/localintel/articles/faq.md):
